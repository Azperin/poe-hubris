<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Poe Hubris</title>
<style>
	* {
		color: white;
		margin: 0px;
		padding: 0px;
		box-sizing: border-box;
		z-index: 2;
	}
	img {
		width: 400px;
		height: 400px;
	}
	body {
		background-color: black;
		min-height: 100vh;
		min-width: 100vm;
		display: flex;
		justify-content: center;
		background-position: center top;
		background-size: contain;
		background-repeat: no-repeat;
	}
	input.filter-skill {
		width: 50px;
		margin-right: 5px;
		color: black;
	}
	.result {
		max-width: 350px;
		min-width: 350px;
		margin: 0 30px;
		padding-top: 20px;
		background-color: black;
		max-height: 90px;
	}
	
	.result input[type="button"] {
		color: black;
		border-radius: 0;
		padding: 10px;
	}
	body > div {
		max-width: 350px;
		min-width: 350px;
		border: 1px solid black;
		padding: 4px;
	}
	.filter-filler {
		position: absolute;
		min-width: 100%;
		min-height: 100%;
		background-color: black;
	}
}
</style>
</head>
<body>
<div class="filter-filler"></div>
<div class="filter-skills-container">
	<div>
		<input id="filter_skill_8" data-val="40" data-skillidx="8" type="number" class="filter-skill" /><label for="filter_skill_8">Rarity of Items found</label>
	</div>
	<div>
		<input id="filter_skill_19" data-val="20" data-skillidx="19" type="number" class="filter-skill" /><label for="filter_skill_19">Flask Effect Duration</label>
	</div>
	<div>
		<input id="filter_skill_40" data-val="12" data-skillidx="40" type="number" class="filter-skill" /><label for="filter_skill_40">Auras Effect</label>
	</div>
	<div>
		<input id="filter_skill_28" data-val="30" data-skillidx="28" type="number" class="filter-skill" /><label for="filter_skill_28">Maximum Mana</label>
	</div>
	<div>
		<input id="filter_skill_33" data-val="10" data-skillidx="33" type="number" class="filter-skill" /><label for="filter_skill_33">Maximum Life</label>
	</div>
	<div>
		<input id="filter_skill_38" data-val="80" data-skillidx="38" type="number" class="filter-skill" /><label for="filter_skill_38">Minions Damage</label>
	</div>
	<div>
		<input id="filter_skill_7" data-val="15" data-skillidx="7" type="number" class="filter-skill" /><label for="filter_skill_7">Cast Speed</label>
	</div>
	<div>
		<input id="filter_skill_42" data-val="15" data-skillidx="42" type="number" class="filter-skill" /><label for="filter_skill_42">Attack Speed</label>
	</div>
	<div>
		<input id="filter_skill_18" data-val="80" data-skillidx="18" type="number" class="filter-skill" /><label for="filter_skill_18">Critical Strike Chance</label>
	</div>
	<div>
		<input id="filter_skill_20" data-val="80" data-skillidx="20" type="number" class="filter-skill" /><label for="filter_skill_20">Critical Strike Chance for Spells</label>
	</div>
	<div>
		<input id="filter_skill_3" data-val="40" data-skillidx="3" type="number" class="filter-skill" /><label for="filter_skill_3">Critical Strike Multiplier</label>
	</div>
	<div>
		<input id="filter_skill_21" data-val="80" data-skillidx="21" type="number" class="filter-skill" /><label for="filter_skill_21">Spell Damage</label>
	</div>
	<div>
		<input id="filter_skill_22" data-val="80" data-skillidx="22" type="number" class="filter-skill" /><label for="filter_skill_22">Physical Damage</label>
	</div>
	<div>
		<input id="filter_skill_30" data-val="80" data-skillidx="30" type="number" class="filter-skill" /><label for="filter_skill_30">Melee Physical Damage</label>
	</div>
	<div>
		<input id="filter_skill_26" data-val="80" data-skillidx="26" type="number" class="filter-skill" /><label for="filter_skill_26">Projectile Attack Damage</label>
	</div>
	<div>
		<input id="filter_skill_4" data-val="80" data-skillidx="4" type="number" class="filter-skill" /><label for="filter_skill_4">Lightning Damage with Attack Skills</label>
	</div>
	<div>
		<input id="filter_skill_2" data-val="80" data-skillidx="2" type="number" class="filter-skill" /><label for="filter_skill_2">Cold Damage with Attack Skills</label>
	</div>
	<div>
		<input id="filter_skill_27" data-val="80" data-skillidx="27" type="number" class="filter-skill" /><label for="filter_skill_27">Fire Damage with Attack Skills</label>
	</div>
	<div>
		<input id="filter_skill_10" data-val="10" data-skillidx="10" type="number" class="filter-skill" /><label for="filter_skill_10">Damage per Frenzy Charge</label>
	</div>
	<div>
		<input id="filter_skill_12" data-val="10" data-skillidx="12" type="number" class="filter-skill" /><label for="filter_skill_12">Damage per Power Charge</label>
	</div>
	<div>
		<input id="filter_skill_11" data-val="10" data-skillidx="11" type="number" class="filter-skill" /><label for="filter_skill_11">Damage per Endurance Charge</label>
	</div>
	<div>
		<input id="filter_skill_44" data-val="37" data-skillidx="44" type="number" class="filter-skill" /><label for="filter_skill_44">Chaos Resistance</label>
	</div>
</div>
<div class="result">
	<div style="display: flex; justify-content: space-between;">
		<input type="button" value="PREV" onClick="showSocket('prev')" />
		<input type="button" value="FILTERS" onClick="toggleFilters()" />
		<input type="button" value="NEXT" onClick="showSocket('next')"/></div>
	<div id="corusel-counter" style="text-align: center;">0</div>
</div>
<div class="filter-sockets-container">
	<div>
		<input data-fsocketid="0" class="filter-socket" id="filter_socket_1" type="checkbox" checked />
		<label for="filter_socket_1">Witch TOP CENTER</label>
	</div>
	<div>
		<input data-fsocketid="1" class="filter-socket" id="filter_socket_2" type="checkbox" checked />
		<label for="filter_socket_2">Witch BOT LEFT</label>
	</div>
	<div>
		<input data-fsocketid="2" class="filter-socket" id="filter_socket_3" type="checkbox" checked />
		<label for="filter_socket_3">Witch BOT RIGHT</label>
	</div>
	<div>
		<input data-fsocketid="3" class="filter-socket" id="filter_socket_4" type="checkbox" checked />
		<label for="filter_socket_4">Shadow TOP RIGHT</label>
	</div>
	<div>
		<input data-fsocketid="4" class="filter-socket" id="filter_socket_5" type="checkbox" checked />
		<label for="filter_socket_5">Shadow CENTER LEFT</label>
	</div>
	<div>
		<input data-fsocketid="5" class="filter-socket" id="filter_socket_6" type="checkbox" checked />
		<label for="filter_socket_6">Shadow BOT RIGHT</label>
	</div>
	<div>
		<input data-fsocketid="6" class="filter-socket" id="filter_socket_7" type="checkbox" checked />
		<label for="filter_socket_7">Duelist TOP RIGHT</label>
	</div>
	<div>
		<input data-fsocketid="7" class="filter-socket" id="filter_socket_8" type="checkbox" checked />
		<label for="filter_socket_8">Duelist BOT CENTER</label>
	</div>
	<div>
		<input data-fsocketid="8" class="filter-socket" id="filter_socket_9" type="checkbox" checked />
		<label for="filter_socket_9">Duelist TOP LEFT</label>
	</div>
	<div>
		<input data-fsocketid="9" class="filter-socket" id="filter_socket_10" type="checkbox" checked />
		<label for="filter_socket_10">Templar BOT LEFT</label>
	</div>
	<div>
		<input data-fsocketid="10" class="filter-socket" id="filter_socket_11" type="checkbox" checked />
		<label for="filter_socket_11">Templar CENTER RIGHT</label>
	</div>
	<div>
		<input data-fsocketid="11" class="filter-socket" id="filter_socket_12" type="checkbox" checked />
		<label for="filter_socket_12">Templar TOP RIGHT</label>
	</div>
	<div>
		<input data-fsocketid="12" class="filter-socket" id="filter_socket_13" type="checkbox" checked />
		<label for="filter_socket_13">Scion LEFT</label>
	</div>
	<div>
		<input data-fsocketid="13" class="filter-socket" id="filter_socket_14" type="checkbox" checked />
		<label for="filter_socket_14">Scion RIGHT</label>
	</div>
	<div>
		<input data-fsocketid="14" class="filter-socket" id="filter_socket_15" type="checkbox" checked />
		<label for="filter_socket_15">Scion CENTER</label>
	</div>
</div>

</body>
<script src="jewelsDB.js"></script>
<script>
	let resultElement = document.querySelector('.result');
	let couruselCounter = document.getElementById('corusel-counter');
	let result = [];
	let currentResultIndex = -1;
	document.querySelectorAll('.filter-socket').forEach(x => {
		x.addEventListener('change', search);
	});
	document.querySelectorAll('.filter-skill').forEach(x => {
		x.addEventListener('input', search);
	});
	search();
	function search() {
		let socketsToCheck = [];
		let skillsToCheck = [];
		result = [];
		
		document.querySelectorAll('.filter-socket').forEach(x => {
			if (x.checked) {
				socketsToCheck.push(parseInt(x.dataset.fsocketid, 10));
			};
		});
		if (socketsToCheck.length === 0) return;
		
		document.querySelectorAll('.filter-skill').forEach(x => {
			let v = parseInt(x.value, 10);
			skillsToCheck.push({
				idx: parseInt(x.dataset.skillidx, 10),
				count: (Number.isNaN(v) ? (-1) : v),
			});
		});
		
		skillsToCheck = skillsToCheck.filter(x => x.count > 0);
		
		Object.keys(jewels).forEach(jewelSeed => {
			jewels[jewelSeed].socketSkills.forEach((socket, sockIdx) => {
				if (!socketsToCheck.includes(sockIdx)) return;
				let isPassed = skillsToCheck.every(x => {
					let q = socket.reduce((a, b) => {
						if (b === x.idx) {
							a += 1;
						};
						return a;
					}, 0);
					
					return q >= x.count;
				});
				if (isPassed) {
					result.push({
						seed: jewelSeed,
						socket: sockIdx,
					});
				};
				
			});
		});
		showSocket('next');
	};
	
	function toggleFilters() {
		let a = document.querySelector('.filter-skills-container').style.display;
		if (a) {
			document.querySelector('.filter-skills-container').style.display = '';
			document.querySelector('.filter-sockets-container').style.display = '';
			document.querySelector('.filter-filler').style.display = '';
		} else {
			document.querySelector('.filter-skills-container').style.display = 'none';
			document.querySelector('.filter-sockets-container').style.display = 'none';
			document.querySelector('.filter-filler').style.display = 'none';
		};		
	};
	
	function showSocket(e) {
		if (result.length === 0) {
			currentResultIndex = -1;
			document.body.style.backgroundImage = '';
			couruselCounter.innerHTML = `0`;
			return;
		};
		let nextIndex;
		if (e === 'next') {
			nextIndex = currentResultIndex + 1;
			if (!result[nextIndex]) {
				nextIndex = 0;
			};
		} else {
			nextIndex = currentResultIndex - 1;
			if (!result[nextIndex]) {
				nextIndex = result.length - 1;
			};
		};
		currentResultIndex = nextIndex;
		couruselCounter.innerHTML = `${(nextIndex + 1)} of ${result.length}`;
		document.body.style.backgroundImage = `url(${jewels[result[nextIndex].seed].socketImgs[result[nextIndex].socket]})`;
	};
	
</script>
</html>
